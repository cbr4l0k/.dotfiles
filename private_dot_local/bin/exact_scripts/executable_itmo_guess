#!/usr/bin/env bash
# Description: Send phone number to ITMO WiFi API for authentication
# Usage: itmo_guess <phone_number>
# By: Juan P. Sierra Useche <cbr4l0k>

set -euo pipefail

# Get the MAC address of wlan0
MAC_ADDR=$(cat /sys/class/net/wlan0/address)

# Caller ID (replace with the correct number if needed)
CALLER_ID="$1"

# API endpoint
URL="https://wifi.api.it.itmo.ru/sendPhone"

# Send request
curl "$URL" \
  -X POST \
  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:141.0) Gecko/20100101 Firefox/141.0' \
  -H 'Accept: application/json, text/plain, */*' \
  -H 'Accept-Language: en-US,en;q=0.5' \
  -H 'Accept-Encoding: gzip, deflate, br, zstd' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'Origin: https://wifi.it.itmo.ru' \
  -H 'Sec-GPC: 1' \
  -H 'Connection: keep-alive' \
  -H 'Referer: https://wifi.it.itmo.ru/' \
  -H 'Sec-Fetch-Dest: empty' \
  -H 'Sec-Fetch-Mode: cors' \
  -H 'Sec-Fetch-Site: same-site' \
  -H 'Priority: u=0' \
  -H 'Pragma: no-cache' \
  -H 'Cache-Control: no-cache' \
  --data-urlencode "mac=$MAC_ADDR" \
  --data-urlencode "caller_id=$CALLER_ID" \
  --compressed
